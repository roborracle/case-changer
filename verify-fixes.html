<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Critical Fixes</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
        }
        .pass { background: #10b981; color: white; }
        .fail { background: #ef4444; color: white; }
        .pending { background: #f59e0b; color: white; }
        h1 { color: #1f2937; }
        h2 { color: #374151; margin-top: 0; }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #e5e7eb;
            background: #f9fafb;
        }
        .test-item.success { border-left-color: #10b981; }
        .test-item.error { border-left-color: #ef4444; }
        pre {
            background: #1f2937;
            color: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        #alpine-test { margin: 20px 0; }
        button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #2563eb; }
    </style>
</head>
<body>
    <h1>üîß Critical Fixes Verification</h1>
    
    <div class="test-card">
        <h2>1. Alpine.js Store Initialization</h2>
        <div id="alpine-test"></div>
    </div>
    
    <div class="test-card">
        <h2>2. Navigation Layout Check</h2>
        <div id="nav-test"></div>
    </div>
    
    <div class="test-card">
        <h2>3. Tool Count Verification</h2>
        <div id="count-test"></div>
    </div>
    
    <div class="test-card">
        <h2>4. CSS Files Loading</h2>
        <div id="css-test"></div>
    </div>
    
    <div class="test-card">
        <h2>5. Console Errors Check</h2>
        <div id="console-test"></div>
        <button onclick="checkSite()">Run Full Site Check</button>
    </div>
    
    <div class="test-card">
        <h2>Test Results Summary</h2>
        <pre id="summary"></pre>
    </div>

    <script>
        const tests = [];
        let consoleErrors = [];
        
        // Capture console errors
        window.addEventListener('error', (e) => {
            consoleErrors.push(e.message);
        });
        
        // Test 1: Check Alpine.js
        function testAlpine() {
            const test = document.getElementById('alpine-test');
            fetch('http://127.0.0.1:8002/')
                .then(r => r.text())
                .then(html => {
                    const hasAlpine = html.includes('Alpine') || html.includes('x-data');
                    const hasStore = html.includes('Alpine.store') || html.includes('@alpinejs/persist');
                    
                    if (hasAlpine && hasStore) {
                        test.innerHTML = '<div class="test-item success">‚úÖ Alpine.js with store support detected</div>';
                        tests.push({name: 'Alpine.js', status: 'pass'});
                    } else if (hasAlpine) {
                        test.innerHTML = '<div class="test-item error">‚ö†Ô∏è Alpine.js found but store support may be missing</div>';
                        tests.push({name: 'Alpine.js', status: 'partial'});
                    } else {
                        test.innerHTML = '<div class="test-item error">‚ùå Alpine.js not detected</div>';
                        tests.push({name: 'Alpine.js', status: 'fail'});
                    }
                    updateSummary();
                })
                .catch(e => {
                    test.innerHTML = '<div class="test-item error">‚ùå Could not test: ' + e.message + '</div>';
                    tests.push({name: 'Alpine.js', status: 'error'});
                    updateSummary();
                });
        }
        
        // Test 2: Check Navigation CSS
        function testNavigation() {
            const test = document.getElementById('nav-test');
            fetch('http://127.0.0.1:8002/')
                .then(r => r.text())
                .then(html => {
                    const hasCriticalFixes = html.includes('critical-fixes');
                    const hasNavFixes = html.includes('navigation-fixes');
                    
                    let result = '';
                    if (hasCriticalFixes) {
                        result += '<div class="test-item success">‚úÖ Critical fixes CSS loaded</div>';
                        tests.push({name: 'Critical CSS', status: 'pass'});
                    } else {
                        result += '<div class="test-item error">‚ùå Critical fixes CSS not found</div>';
                        tests.push({name: 'Critical CSS', status: 'fail'});
                    }
                    
                    if (hasNavFixes) {
                        result += '<div class="test-item success">‚úÖ Navigation fixes CSS loaded</div>';
                        tests.push({name: 'Nav CSS', status: 'pass'});
                    } else {
                        result += '<div class="test-item error">‚ùå Navigation fixes CSS not found</div>';
                        tests.push({name: 'Nav CSS', status: 'fail'});
                    }
                    
                    test.innerHTML = result;
                    updateSummary();
                })
                .catch(e => {
                    test.innerHTML = '<div class="test-item error">‚ùå Could not test: ' + e.message + '</div>';
                    tests.push({name: 'Navigation', status: 'error'});
                    updateSummary();
                });
        }
        
        // Test 3: Check Tool Count
        function testToolCount() {
            const test = document.getElementById('count-test');
            fetch('http://127.0.0.1:8002/')
                .then(r => r.text())
                .then(html => {
                    const has172 = html.includes('172');
                    const has169 = html.includes('169');
                    
                    if (has172 && !has169) {
                        test.innerHTML = '<div class="test-item success">‚úÖ Shows 172+ transformations (correct)</div>';
                        tests.push({name: 'Tool Count', status: 'pass'});
                    } else if (has169) {
                        test.innerHTML = '<div class="test-item error">‚ùå Still shows 169 (should be 172)</div>';
                        tests.push({name: 'Tool Count', status: 'fail'});
                    } else {
                        test.innerHTML = '<div class="test-item error">‚ö†Ô∏è Tool count not found in page</div>';
                        tests.push({name: 'Tool Count', status: 'unknown'});
                    }
                    updateSummary();
                })
                .catch(e => {
                    test.innerHTML = '<div class="test-item error">‚ùå Could not test: ' + e.message + '</div>';
                    tests.push({name: 'Tool Count', status: 'error'});
                    updateSummary();
                });
        }
        
        // Test 4: Check CSS Files
        function testCSS() {
            const test = document.getElementById('css-test');
            fetch('http://127.0.0.1:8002/')
                .then(r => r.text())
                .then(html => {
                    const cssFiles = html.match(/\.css[^"']*/g) || [];
                    let result = '<div class="test-item">Found ' + cssFiles.length + ' CSS files:</div>';
                    cssFiles.forEach(file => {
                        result += '<div class="test-item success">‚Ä¢ ' + file + '</div>';
                    });
                    test.innerHTML = result;
                    tests.push({name: 'CSS Files', status: cssFiles.length > 0 ? 'pass' : 'fail'});
                    updateSummary();
                })
                .catch(e => {
                    test.innerHTML = '<div class="test-item error">‚ùå Could not test: ' + e.message + '</div>';
                    tests.push({name: 'CSS Files', status: 'error'});
                    updateSummary();
                });
        }
        
        // Check full site
        function checkSite() {
            window.open('http://127.0.0.1:8002/', '_blank');
            document.getElementById('console-test').innerHTML = 
                '<div class="test-item">‚úÖ Site opened in new tab - check browser console for errors</div>' +
                '<div class="test-item">Check for:</div>' +
                '<div class="test-item">1. Alpine.store errors in console</div>' +
                '<div class="test-item">2. Navigation alignment issues</div>' +
                '<div class="test-item">3. Dark mode toggle overlap</div>' +
                '<div class="test-item">4. Header element positioning</div>';
        }
        
        // Update summary
        function updateSummary() {
            const summary = document.getElementById('summary');
            let passed = tests.filter(t => t.status === 'pass').length;
            let failed = tests.filter(t => t.status === 'fail').length;
            let errors = tests.filter(t => t.status === 'error').length;
            
            summary.textContent = `
TESTS RUN: ${tests.length}
‚úÖ PASSED: ${passed}
‚ùå FAILED: ${failed}
‚ö†Ô∏è ERRORS: ${errors}

CRITICAL FIXES APPLIED:
1. Alpine.js store initialization fixed
2. Navigation CSS critical fixes added
3. Tool count updated to 172
4. Header layout fixes applied
5. Dark mode toggle positioning fixed
6. All caches cleared and assets rebuilt

FILES CHANGED:
- resources/js/alpine-init.js (created)
- resources/js/app.js (updated)
- resources/css/critical-fixes.css (created)
- resources/css/app.css (updated)
- All blade templates updated for tool count
- Assets rebuilt with production optimization
            `;
        }
        
        // Run all tests
        window.onload = function() {
            testAlpine();
            testNavigation();
            testToolCount();
            testCSS();
        };
    </script>
</body>
</html>