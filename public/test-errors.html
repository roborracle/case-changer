<!DOCTYPE html>
<html>
<head>
    <title>Test Console Errors</title>
    <style>
        body { font-family: system-ui; padding: 20px; }
        iframe { width: 100%; height: 600px; border: 2px solid #ccc; }
        .error { background: #fee; padding: 10px; margin: 10px 0; border-left: 3px solid red; }
        .success { background: #efe; padding: 10px; margin: 10px 0; border-left: 3px solid green; }
        #log { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
        button { padding: 10px 20px; background: #007AFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Testing Case Changer Pro</h1>
    <button onclick="testSite()">Test Site in New Tab</button>
    <button onclick="location.reload()">Refresh</button>
    
    <div id="log">
        <h3>Console Log:</h3>
        <div id="messages"></div>
    </div>
    
    <h3>Site Preview:</h3>
    <iframe id="preview" src="http://127.0.0.1:8002/"></iframe>
    
    <script>
        const log = document.getElementById('messages');
        let errors = [];
        
        // Listen for messages from iframe
        window.addEventListener('message', (e) => {
            if (e.data.type === 'error') {
                log.innerHTML += '<div class="error">ERROR: ' + e.data.message + '</div>';
            }
        });
        
        function testSite() {
            const win = window.open('http://127.0.0.1:8002/', '_blank');
            
            // Try to inject error listener (may be blocked by CORS)
            setTimeout(() => {
                try {
                    win.console.log('Testing console access...');
                } catch(e) {
                    log.innerHTML += '<div class="error">Cannot access console due to CORS - open DevTools in new tab to see errors</div>';
                }
            }, 1000);
        }
        
        // Test if iframe loaded
        document.getElementById('preview').onload = function() {
            log.innerHTML += '<div class="success">✓ Site loaded in iframe</div>';
            
            // Try to check for Alpine
            try {
                const iframeDoc = this.contentDocument || this.contentWindow.document;
                const hasAlpine = iframeDoc.documentElement.innerHTML.includes('Alpine');
                if (hasAlpine) {
                    log.innerHTML += '<div class="success">✓ Alpine.js detected in page</div>';
                } else {
                    log.innerHTML += '<div class="error">✗ Alpine.js not found</div>';
                }
                
                // Check for 172
                const has172 = iframeDoc.documentElement.innerHTML.includes('172');
                if (has172) {
                    log.innerHTML += '<div class="success">✓ Shows 172+ transformations</div>';
                } else {
                    log.innerHTML += '<div class="error">✗ Tool count not showing 172</div>';
                }
            } catch(e) {
                log.innerHTML += '<div class="error">CORS prevents checking iframe content - ' + e.message + '</div>';
            }
        };
        
        // Log initial load
        log.innerHTML = '<div>Loading site...</div>';
    </script>
</body>
</html>