<!DOCTYPE html>
<html>
<head>
    <title>CSP Test</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>CSP Violation Test</h1>
    <div id="results">Testing...</div>
    
    <script>
        const results = document.getElementById('results');
        let violations = [];
        
        // Listen for CSP violations
        document.addEventListener('securitypolicyviolation', (e) => {
            violations.push({
                directive: e.violatedDirective,
                blockedURI: e.blockedURI,
                lineNumber: e.lineNumber,
                sourceFile: e.sourceFile
            });
            updateResults();
        });
        
        // Test inline script
        try {
            eval('console.log("eval test")');
        } catch(e) {
            console.log('eval blocked:', e.message);
        }
        
        // Test inline style
        try {
            const div = document.createElement('div');
            div.style.display = 'none';
            document.body.appendChild(div);
        } catch(e) {
            console.log('inline style blocked:', e.message);
        }
        
        function updateResults() {
            if (violations.length === 0) {
                results.innerHTML = '<p style="color: green;">âœ“ No CSP violations detected</p>';
            } else {
                results.innerHTML = '<p style="color: red;">CSP Violations Found:</p>' +
                    '<ul>' + violations.map(v => 
                        `<li>${v.directive} - ${v.blockedURI || 'inline'}</li>`
                    ).join('') + '</ul>';
            }
        }
        
        // Check after page load
        setTimeout(() => {
            updateResults();
            
            // Test the main page via iframe
            const iframe = document.createElement('iframe');
            iframe.src = '/';
            iframe.style.width = '100%';
            iframe.style.height = '400px';
            iframe.style.border = '1px solid #ccc';
            iframe.style.marginTop = '20px';
            document.body.appendChild(iframe);
        }, 1000);
    </script>
</body>
</html>